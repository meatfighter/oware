(()=>{"use strict";var e={4(e,t,s){s.d(t,{DQ:()=>I,Go:()=>c,Nx:()=>d,pR:()=>A});var n=s(855);class i{cancelled=!1}const a=1e5;class r{value=0;bestChild=null;outcome=n.Z6.INTERMEDIATE}var o;!function(e){e[e.ENTERED=0]="ENTERED",e[e.BEFORE=1]="BEFORE",e[e.AFTER=2]="AFTER"}(o||(o={}));class u{node=new n.nF;alpha=0;beta=0;children=[];value=0;bestChild=null;outcome=n.Z6.INTERMEDIATE;i=0;state=o.ENTERED}const l=new Array(32).fill(null).map(()=>new u);async function h(e,t,s){const i=l[t];i.node=e,i.alpha=-1/0,i.beta=1/0,await async function(e,t){const s=e;l[e].state=o.ENTERED;let i=a;for(;e<=s&&(0!==--i||(i=a,await new Promise(e=>setTimeout(e,0)),!t.cancelled));){const t=l[e];switch(t.state){case o.ENTERED:if(0===e||t.node.type!==n.Z6.INTERMEDIATE){t.value=-t.node.createPlayer*t.node.heuristicValue,t.outcome=t.node.type,t.bestChild=null,++e;continue}t.children=t.node.children(),t.value=-1/0,t.bestChild=null,t.outcome=n.Z6.INTERMEDIATE,t.i=0,t.state=o.BEFORE;break;case o.BEFORE:{if(t.i===t.children.length){++e;continue}const s=l[--e];s.node=t.children[t.i++],t.state=o.AFTER,s.state=o.ENTERED,s.alpha=-t.beta,s.beta=-t.alpha;break}case o.AFTER:{const s=l[e-1];if(-s.value>t.value&&(t.value=-s.value,t.bestChild=s.node,t.outcome=s.outcome),t.alpha=Math.max(t.alpha,t.value),t.alpha>=t.beta){++e;continue}t.state=o.BEFORE;break}}}}(t,s);const u=new r;return u.bestChild=i.bestChild,u.value=i.value,u.outcome=i.outcome,u}var c;!function(e){e[e.SEARCH_MANY=0]="SEARCH_MANY",e[e.SEARCH_NARROW=1]="SEARCH_NARROW",e[e.SEARCH_RESPONSE=2]="SEARCH_RESPONSE",e[e.CANCEL_ALL=3]="CANCEL_ALL"}(c||(c={}));class d{type=c.SEARCH_MANY;requestID;nodes;depth;constructor(e,t,s){this.requestID=e,this.nodes=t,this.depth=s}}class A{type=c.SEARCH_NARROW;requestID;nodeIndex;constructor(e,t){this.nodeIndex=t,this.requestID=e}}class I{type=c.CANCEL_ALL}class E{type=c.SEARCH_RESPONSE;results;requestID;constructor(e,t){this.results=e,this.requestID=t}}class D{searchManyRequest;canceller=new i;cancelled;results;nodeIndex=0;constructor(e){this.searchManyRequest=e,this.cancelled=new Array(e.nodes.length).fill(!1),this.results=new Array(e.nodes.length).fill(null)}}const p=[];let R=!1;onmessage=async e=>{const t=e.data;switch(t.type){case c.SEARCH_MANY:await async function(e){if(function(e){if(0===e.length)return;let t=function(e){let t=null,s=null;for(;null!==e.parent;)if(e=e.parent,null===s)s=t=new n.nF(e),s.parent=null;else{const t=new n.nF(e);t.parent=null,s.parent=t,s=t}return t}(e[0]);for(let s=e.length-1;s>=0;--s)e[s]=new n.nF(e[s]),e[s].parent=t}(e.nodes),p.push(new D(e)),!R){for(R=!0;p.length>0;){const e=p[0];if(e.nodeIndex<e.searchManyRequest.nodes.length){if(e.canceller.cancelled=!1,e.cancelled[e.nodeIndex])e.results[e.nodeIndex]=null;else{const t=await h(e.searchManyRequest.nodes[e.nodeIndex],e.searchManyRequest.depth,e.canceller);t&&t.bestChild&&!e.cancelled[e.nodeIndex]?(t.bestChild.parent=null,e.results[e.nodeIndex]=t):e.results[e.nodeIndex]=null}++e.nodeIndex}else{p.shift();for(let t of e.cancelled)if(!t){postMessage(new E(e.results,e.searchManyRequest.requestID));break}}}R=!1}}(t);break;case c.SEARCH_NARROW:!function(e){for(let t of p)if(t.searchManyRequest.requestID===e.requestID){t.nodeIndex!==e.nodeIndex&&(t.canceller.cancelled=!0);for(let s=t.cancelled.length-1;s>=0;--s)t.cancelled[s]=s!==e.nodeIndex}}(t);break;case c.CANCEL_ALL:!function(){for(let e of p){e.canceller.cancelled=!0;for(let t=e.cancelled.length-1;t>=0;--t)e.cancelled[t]=!0}}()}}},855(e,t,s){var n,i,a;s.d(t,{Z6:()=>i,_j:()=>a,ai:()=>n,nF:()=>r}),function(e){e[e.A=1]="A",e[e.B=-1]="B"}(n||(n={})),function(e){e[e.INTERMEDIATE=0]="INTERMEDIATE",e[e.DRAW=1]="DRAW",e[e.A_WON=2]="A_WON",e[e.B_WON=3]="B_WON"}(i||(i={})),function(e){e[e.RESET=0]="RESET",e[e.SOWED=1]="SOWED",e[e.CAPTURED_REMAINDER=2]="CAPTURED_REMAINDER"}(a||(a={}));class r{static PERMUTATIONS=[];static{!function e(t=[],s=0,n=new Array(6).fill(!1)){if(6===s)r.PERMUTATIONS.push(t.slice());else for(let i=0;i<6;++i)n[i]||(n[i]=!0,t[s]=i,e(t,s+1,n),n[i]=!1)}()}parent;houses;scoreA;scoreB;hash;type;heuristicValue;createPlayer;createOperation;createSownHouse;createCaptured;constructor(e=null){null===e?(this.parent=null,this.houses=new Array(12).fill(4),this.scoreA=0,this.scoreB=0,this.hash=0,this.type=i.INTERMEDIATE,this.heuristicValue=0,this.createPlayer=n.B,this.createOperation=a.RESET,this.createSownHouse=-1,this.createCaptured=!1):(this.parent=e,this.houses=e.houses.slice(),this.scoreA=e.scoreA,this.scoreB=e.scoreB,this.hash=e.hash,this.type=e.type,this.heuristicValue=e.heuristicValue,this.createPlayer=e.createPlayer,this.createOperation=e.createOperation,this.createSownHouse=e.createSownHouse,this.createCaptured=e.createCaptured)}children(){if(this.type!==i.INTERMEDIATE)return[];const e=this.createPlayer===n.B?0:6,t=[],s=r.PERMUTATIONS[Math.floor(Math.random()*r.PERMUTATIONS.length)];for(let n=5;n>=0;--n){const i=this.attemptSow(e+s[n]);null!==i&&t.push(i)}if(0===t.length){const e=new r(this);e.createPlayer=-this.createPlayer,e.createOperation=a.CAPTURED_REMAINDER,e.createSownHouse=-1,e.createCaptured=!1;for(let t=11;t>=6;--t)e.scoreB+=e.houses[t],e.houses[t]=0;for(let t=5;t>=0;--t)e.scoreA+=e.houses[t],e.houses[t]=0;e.determineHashTypeAndHeuristicValue(),t.push(e)}else this.createPlayer===n.A?t.sort((e,t)=>e.heuristicValue-t.heuristicValue):t.sort((e,t)=>t.heuristicValue-e.heuristicValue);return t}attemptSow(e){if(0===this.houses[e])return null;const t=new r(this);t.createPlayer=-this.createPlayer,t.createOperation=a.SOWED,t.createSownHouse=e,t.createCaptured=!1;let s=t.houses[e];t.houses[e]=0;let i=e;for(;s>0;)++i>11&&(i=0),i===e&&++i>11&&(i=0),--s,++t.houses[i];if(t.createPlayer===n.A){if(i>=6){for(;i>=6&&(2===t.houses[i]||3===t.houses[i]);)t.houses[i]=-t.houses[i],--i;let e=0;for(let s=11;s>=6;--s)t.houses[s]<=0&&++e;if(6===e)for(let e=11;e>=6;--e)t.houses[e]<0&&(t.houses[e]=-t.houses[e]);else for(let e=11;e>=6;--e)t.houses[e]<0&&(t.scoreA-=t.houses[e],t.houses[e]=0,t.createCaptured=!0)}for(let e=11;e>=6;--e)if(0!==t.houses[e])return t.determineHashTypeAndHeuristicValue(),t.checkThreefoldRepetition(),t}else{if(i<6){for(;i>=0&&(2===t.houses[i]||3===t.houses[i]);)t.houses[i]=-t.houses[i],--i;let e=0;for(let s=5;s>=0;--s)t.houses[s]<=0&&++e;if(6===e)for(let e=5;e>=0;--e)t.houses[e]<0&&(t.houses[e]=-t.houses[e]);else for(let e=5;e>=0;--e)t.houses[e]<0&&(t.scoreB-=t.houses[e],t.houses[e]=0,t.createCaptured=!0)}for(let e=5;e>=0;--e)if(0!==t.houses[e])return t.determineHashTypeAndHeuristicValue(),t.checkThreefoldRepetition(),t}return null}checkThreefoldRepetition(){e:{for(let e=11;e>=6;--e)if(this.houses[e]>0)break e;return}e:{for(let e=5;e>=0;--e)if(this.houses[e]>0)break e;return}let e=this.parent,t=0;for(;null!==e&&e.scoreA===this.scoreA&&e.scoreB===this.scoreB;){e:if(e.createPlayer===this.createPlayer&&e.hash===this.hash){for(let t=11;t>=0;--t)if(e.houses[t]!==this.houses[t])break e;if(3===++t){this.createOperation=a.CAPTURED_REMAINDER;for(let e=11;e>=6;--e)this.scoreB+=this.houses[e];for(let e=5;e>=0;--e)this.scoreA+=this.houses[e];return void this.determineHashTypeAndHeuristicValue()}}e=e.parent}}determineHashTypeAndHeuristicValue(){const e=this.scoreA<<24|this.houses[3]<<18|this.houses[2]<<12|this.houses[1]<<6|this.houses[0],t=this.scoreB<<25|this.houses[7]<<19|this.houses[6]<<13|this.houses[5]<<7|this.houses[4]<<1,s=this.houses[11]<<21|this.houses[10]<<15|this.houses[9]<<9|this.houses[8]<<3;this.hash=e^t^s,this.heuristicValue=200*(this.scoreA-this.scoreB),24===this.scoreA&&24===this.scoreB?this.type=i.DRAW:this.scoreA>24?(this.type=i.A_WON,this.heuristicValue+=1e4):this.scoreB>24?(this.type=i.B_WON,this.heuristicValue-=1e4):this.type=i.INTERMEDIATE;for(let e=11;e>=6;--e)switch(this.houses[e]){case 0:this.heuristicValue+=10;break;case 1:this.heuristicValue+=20;break;case 2:this.heuristicValue+=30}for(let e=5;e>=0;--e)switch(this.houses[e]){case 0:this.heuristicValue-=10;break;case 1:this.heuristicValue-=20;break;case 2:this.heuristicValue-=30}for(let e=10;e>=6;--e)this.houses[e]<=2&&this.houses[e+1]<=2&&++this.heuristicValue;for(let e=4;e>=0;--e)this.houses[e]<=2&&this.houses[e+1]<=2&&--this.heuristicValue}pad(e){return e<10?`0${e}`:`${e}`}toString(){return`   ${this.pad(this.houses[11])} ${this.pad(this.houses[10])} ${this.pad(this.houses[9])} ${this.pad(this.houses[8])} ${this.pad(this.houses[7])} ${this.pad(this.houses[6])}\n${this.pad(this.scoreB)}                   ${this.pad(this.scoreA)}\n   ${this.pad(this.houses[0])} ${this.pad(this.houses[1])} ${this.pad(this.houses[2])} ${this.pad(this.houses[3])} ${this.pad(this.houses[4])} ${this.pad(this.houses[5])}`}}}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.d({},{m2:()=>Ze,Ir:()=>qe,aA:()=>$e,Re:()=>xe});var n=s(855);const i=1,a=19;let r=n.ai.A,o=i,u=!1;function l(){document.getElementById("main-content").innerHTML=`\n            <div id="start-div">\n                <div id="level-div">\n                    <button id="minus-button">&minus;</button>\n                    <span id="level-span" class="no-wrap">Level ${o}</span>\n                    <button id="plus-button">&plus;</button>\n                </div>\n                <div id="first-player-div">\n                    <input type="radio" id="human-radio" name="first-player" value="human" \n                            ${r===n.ai.A?"checked":""}>\n                    <label for="human-radio" class="no-wrap">Human First</label>                \n                    <input type="radio" id="ai-radio" name="first-player" value="ai"\n                            ${r===n.ai.B?"checked":""}>\n                    <label for="ai-radio" class="no-wrap">AI First</label>\n                </div>\n                <div id="go-div">\n                    <button id="start-button">Start</button>\n                </div>\n            </div>`,document.getElementById("minus-button").addEventListener("click",e=>{o>i&&(--o,h())}),document.getElementById("plus-button").addEventListener("click",e=>{o<a&&(++o,h())}),document.getElementById("human-radio").addEventListener("click",e=>{r=n.ai.A}),document.getElementById("ai-radio").addEventListener("click",e=>{r=n.ai.B}),document.getElementById("start-button").addEventListener("click",e=>{xe(r,o)}),h(),c()}function h(){const e=document.getElementById("minus-button"),t=document.getElementById("plus-button"),s=document.getElementById("level-span");if(s.style.width="",s.style.display="inline-block",s.style.textAlign="center",s.textContent="Level 00",u){const e=s.getBoundingClientRect().width;s.style.width=`${e}px`}else{const e=s.getBoundingClientRect().height;s.style.width=`${e}px`}s.textContent=`Level ${o}`,e.disabled=o===i,t.disabled=o===a}function c(){const e=document.getElementById("start-div"),t=document.getElementById("minus-button"),s=document.getElementById("plus-button");t.style.width=s.style.width=e.style.top=e.style.left=e.style.transform="",e.style.display="none";const n=window.innerWidth,i=window.innerHeight;if(u=n>=i,e.style.display="flex",t.style.width=s.style.width=`${s.getBoundingClientRect().width}px`,u){const t=e.getBoundingClientRect();e.style.left=(n-t.width)/2+"px",e.style.top=(i-t.height)/2+"px"}else{e.style.transform="rotate(-90deg)";const t=e.getBoundingClientRect();e.style.left=(n-t.height)/2+"px",e.style.top=(i-t.width)/2+"px"}h()}class d{x;y;constructor(e,t){this.x=e,this.y=t}}const A=(()=>{const e=new Array(49).fill(null).map(()=>[]),t=atob("AAAAAAAAAAAAAAgAAAAAIAAAAAIAACAACAACAAAiAAAAIgAAIgAIACIAACIAIgAiAAAiACoAIgAAIggiCCIAACoAqgAqAACqAFUAqgAA1QCqANUAgFWAVYBVgFUAQQhBAFWqAFUA1QCq1QCqANUA1dUA1QDVANXVANUI1QDV1SDVANUC1dUg1QjVAtVVolWAVSLV1SLVCNUi1dUi1SLVItXVItUq1SLVVSpVIlUqVQ==");for(let s=0;s<49;++s){const n=e[s];let i,a;s<=24?(i=s,a=0):(i=49-s,a=255),i*=7;for(let e=0;e<7;++e){let s=a^t.charCodeAt(i+e);for(let t=0;t<7;++t,s>>=1)1&~s||n.push(new d(t,e))}}return e})(),I=1e3/60,E=5;let D=!1,p=0,R=0,f=0;function T(){D||(D=!0,f=0,p=requestAnimationFrame(_),R=performance.now())}function N(){D&&(D=!1,cancelAnimationFrame(p))}function _(){if(!D)return;p=requestAnimationFrame(_),Se();const e=performance.now(),t=e-R;R=e,f+=t;let s=0;for(;f>=I&&D;)if(He(),f-=I,++s>E){f=0,R=performance.now();break}}const F=500/I,H=1/F;var S;!function(e){e.BROWN="#C3986F",e.CYAN="#00B9BA",e.DARK_GRAY="#1E1F22",e.LIGHT_CYAN="#4DFFFF",e.LIGHT_GRAY="#BCBEC4",e.LIGHT_MAGENTA="#FFA9FF",e.MAGENTA="#FF32FF"}(S||(S={}));const g=Z(S.MAGENTA,S.LIGHT_MAGENTA,64),y=Z(S.BROWN,S.MAGENTA,64),G=Z(S.CYAN,S.LIGHT_CYAN,64),m=Z(S.BROWN,S.CYAN,64);var C,O,w,W,b,v,M;!function(e){e[e.SIZE=100]="SIZE",e[e.PADDING=15]="PADDING",e[e.RADIUS=20]="RADIUS"}(C||(C={})),function(e){e[e.RADIUS=6.25]="RADIUS",e[e.DIAMETER=12.5]="DIAMETER"}(O||(O={})),function(e){e[e.WIDTH=18]="WIDTH",e[e.BAR_HEIGHT=2]="BAR_HEIGHT",e[e.PADDING=5]="PADDING",e[e.HEIGHT=12]="HEIGHT"}(w||(w={})),function(e){e[e.RADIUS=12.5]="RADIUS",e[e.DIAMETER=25]="DIAMETER"}(W||(W={})),function(e){e[e.SIZE=12.5]="SIZE",e[e.PADDING=9.375]="PADDING"}(b||(b={})),function(e){e[e.WIDTH=56.25]="WIDTH",e[e.HEIGHT=12.5]="HEIGHT"}(v||(v={})),function(e){e[e.WIDTH=905]="WIDTH",e[e.HEIGHT=215]="HEIGHT"}(M||(M={}));const P=function(e,t,s,n,i){const a=new Path2D;return a.roundRect(0,0,s,n,i),a}(0,0,C.SIZE,C.SIZE,C.RADIUS),B=Y(O.RADIUS),k=function(){const e=new Path2D;return e.rect(0,0,w.WIDTH,w.BAR_HEIGHT),e.rect(0,w.PADDING,w.WIDTH,w.BAR_HEIGHT),e.rect(0,2*w.PADDING,w.WIDTH,w.BAR_HEIGHT),e}(),V=Y(W.RADIUS),U=function(e){const t=new Path2D;return t.arc(0,0,e,Math.PI,2*Math.PI),t}(W.RADIUS),L=function(){const e=new Array(4).fill(null).map(()=>new Path2D),t=-(3*b.SIZE+2*b.PADDING)/2;for(let s=3;s>=0;--s)for(let n=s;n>0;--n)e[s].rect(t+(n-1)*(b.SIZE+b.PADDING),0,b.SIZE,b.SIZE);return e}(),x=function(){const e=new Path2D;return e.rect(-v.WIDTH/2,0,v.WIDTH,v.HEIGHT),e}();function Z(e,t,s){const n=Q(e),i=Q(t),a=[i[0]-n[0],i[1]-n[1],i[2]-n[2]],r=new Array(s);for(let e=s-1;e>=0;--e){const t=e/(s-1);r[e]=q([n[0]+t*a[0],n[1]+t*a[1],n[2]+t*a[2]])}return r}function q(e){return`#${$(e[0])}${$(e[1])}${$(e[2])}`}function $(e){return Math.max(0,Math.min(255,Math.round(e))).toString(16).padStart(2,"0").toUpperCase()}function Q(e){return[parseInt(e.substring(1,3),16),parseInt(e.substring(3,5),16),parseInt(e.substring(5,7),16)]}function Y(e){const t=new Path2D;return t.arc(0,0,e,0,2*Math.PI),t}class j{seeds=0;gradient=m;gradientFrac=0;updater=null}var K;!function(e){e[e.INTERMEDIATE=0]="INTERMEDIATE",e[e.A_FAVORED=1]="A_FAVORED",e[e.B_FAVORED=2]="B_FAVORED",e[e.DRAW_FAVORED=3]="DRAW_FAVORED",e[e.A_WON=4]="A_WON",e[e.B_WON=5]="B_WON",e[e.DRAW=6]="DRAW"}(K||(K={}));const X=100/I;var z;!function(e){e[e.SOWING=0]="SOWING",e[e.CAPTURING=1]="CAPTURING",e[e.WAITING_FOR_MOVE_FADE=2]="WAITING_FOR_MOVE_FADE",e[e.WAITING_FOR_CLEAR_FADE=3]="WAITING_FOR_CLEAR_FADE",e[e.FINISHED_CLEAR_FADE=4]="FINISHED_CLEAR_FADE",e[e.DONE=5]="DONE"}(z||(z={}));class J{board;player;timer;seeds;currentHouse;sourceHouse;capture;moveDone;waitForMoveFade;updatesDone;state;constructor(e,t,s,i,a,r){this.board=e,this.player=t,this.sourceHouse=s,this.capture=i,this.moveDone=a,this.waitForMoveFade=r,this.updatesDone=null,this.state=z.SOWING;const o=this.board.houseStates[s];this.currentHouse=s+1,this.currentHouse>11&&(this.currentHouse=0),this.seeds=o.seeds,o.seeds=0,o.gradient=t===n.ai.A?G:g,o.gradientFrac=1,o.updater=this,this.timer=F}set updatesDoneCallback(e){this.updatesDone=e}update(){switch(this.state){case z.SOWING:this.updateSow();break;case z.CAPTURING:this.updateCapture();break;case z.WAITING_FOR_MOVE_FADE:this.updateWaitingForMoveFade();break;case z.WAITING_FOR_CLEAR_FADE:this.updateWaitingForClearFade();break;case z.FINISHED_CLEAR_FADE:this.updateFinishedClearFade()}}updateSow(){if(this.timer>0)return void--this.timer;const e=this.board.houseStates[this.currentHouse];++e.seeds,e.gradient=this.player===n.ai.A?G:g,e.gradientFrac=1,e.updater=this,this.timer=X,--this.seeds>0?(++this.currentHouse>11&&(this.currentHouse=0),this.currentHouse===this.sourceHouse&&++this.currentHouse>11&&(this.currentHouse=0)):this.capture?(this.timer=F,this.state=z.CAPTURING):this.state=z.WAITING_FOR_MOVE_FADE}updateCapture(){if(this.timer>0)return void--this.timer;const e=this.board.houseStates[this.currentHouse],t=this.board.houseStates[this.player===n.ai.A?12:13];if(t.seeds+=e.seeds,e.seeds=0,e.gradient=t.gradient=this.player===n.ai.A?G:g,e.gradientFrac=t.gradientFrac=1,t.updater=e.updater=this,this.timer=X,--this.currentHouse<(this.player===n.ai.A?6:0))this.state=z.WAITING_FOR_MOVE_FADE;else{const e=this.board.houseStates[this.currentHouse];(e.seeds<2||e.seeds>3)&&(this.state=z.WAITING_FOR_MOVE_FADE)}}isFadeCompleted(){for(let e=13;e>=0;--e){const t=this.board.houseStates[e];if(t.updater===this&&t.gradientFrac>0)return!1}return!0}updateWaitingForMoveFade(){if(this.moveDone&&!this.waitForMoveFade&&(this.moveDone(),this.moveDone=null),this.isFadeCompleted()){for(let e=13;e>=0;--e){const t=this.board.houseStates[e];t.updater===this&&(t.gradient===G?(t.gradient=m,t.gradientFrac=1):t.gradient===g&&(t.gradient=y,t.gradientFrac=1))}this.state=z.WAITING_FOR_CLEAR_FADE,this.moveDone&&(this.moveDone(),this.moveDone=null)}}updateWaitingForClearFade(){this.isFadeCompleted()&&(this.state=z.FINISHED_CLEAR_FADE)}updateFinishedClearFade(){for(let e=13;e>=0;--e){const t=this.board.houseStates[e];t.updater===this&&(t.updater=null)}this.updatesDone&&(this.updatesDone(),this.updatesDone=null)}}const ee=100/I;var te;!function(e){e[e.WAITING_FOR_FADE=0]="WAITING_FOR_FADE",e[e.CAPTURING=1]="CAPTURING",e[e.WAITING_FOR_CAPTURE_FADE=2]="WAITING_FOR_CAPTURE_FADE",e[e.WAITING_FOR_CLEAR_FADE=3]="WAITING_FOR_CLEAR_FADE",e[e.FINISHED_CLEAR_FADE=4]="FINISHED_CLEAR_FADE",e[e.DONE=5]="DONE"}(te||(te={}));class se{board;player;timer;scoreHouseState;currentHouse;state;capturesDone;updatesDone;constructor(e,t,s){for(this.board=e,this.player=t,this.timer=F,this.scoreHouseState=e.houseStates[t===n.ai.A?12:13],this.capturesDone=s,this.updatesDone=null,this.currentHouse=t===n.ai.A?0:6;;){if(this.currentHouse>(this.player===n.ai.A?5:11)){this.state=te.FINISHED_CLEAR_FADE;break}if(this.board.houseStates[this.currentHouse].seeds>0){this.state=te.CAPTURING;break}++this.currentHouse}}set updatesDoneCallback(e){this.updatesDone=e}update(){switch(this.state){case te.CAPTURING:this.updateCapture();break;case te.WAITING_FOR_CAPTURE_FADE:this.updateWaitingForCaptureFade();break;case te.WAITING_FOR_CLEAR_FADE:this.updateWaitingForClearFade();break;case te.FINISHED_CLEAR_FADE:this.updateFinishedClearFade()}}updateCapture(){if(this.timer>0)return void--this.timer;const e=this.board.houseStates[this.currentHouse];for(this.scoreHouseState.seeds+=e.seeds,e.seeds=0,this.scoreHouseState.gradient=e.gradient=this.player===n.ai.A?G:g,this.scoreHouseState.gradientFrac=e.gradientFrac=1,this.scoreHouseState.updater=e.updater=this;;){if(this.currentHouse>(this.player===n.ai.A?5:11))return void(this.state=te.WAITING_FOR_CAPTURE_FADE);if(this.board.houseStates[this.currentHouse].seeds>0)break;++this.currentHouse}this.timer=ee}updateWaitingForCaptureFade(){if(this.capturesDone&&(this.capturesDone(),this.capturesDone=null),this.isFadeCompleted()){for(let e=13;e>=0;--e){const t=this.board.houseStates[e];t.updater===this&&(t.gradient===G?(t.gradient=m,t.gradientFrac=1):t.gradient===g&&(t.gradient=y,t.gradientFrac=1))}this.state=te.WAITING_FOR_CLEAR_FADE}}isFadeCompleted(){for(let e=13;e>=0;--e){const t=this.board.houseStates[e];if(t.updater===this&&t.gradientFrac>0)return!1}return!0}updateWaitingForClearFade(){this.isFadeCompleted()&&(this.state=te.FINISHED_CLEAR_FADE)}updateFinishedClearFade(){for(let e=13;e>=0;--e){const t=this.board.houseStates[e];t.updater===this&&(t.updater=null)}this.capturesDone&&(this.capturesDone(),this.capturesDone=null),this.updatesDone&&(this.updatesDone(),this.updatesDone=null)}}const ne=1e3/I,ie=500/I;var ae;!function(e){e[e.WAITING_TO_APPEAR=0]="WAITING_TO_APPEAR",e[e.DOTTING=1]="DOTTING",e[e.FINISHING=2]="FINISHING",e[e.DONE=3]="DONE"}(ae||(ae={}));class re{board;thinkingDone;timer;state;constructor(e){this.board=e,this.thinkingDone=null,this.timer=ne,this.state=ae.WAITING_TO_APPEAR,e.thinkingIndex=0}set thinkingDoneCallback(e){this.thinkingDone=e}stop(){this.state=ae.FINISHING,this.board.thinkingIndex=0}update(){switch(this.state){case ae.WAITING_TO_APPEAR:this.updateWaitToAppear();break;case ae.DOTTING:this.updateDots();break;case ae.FINISHING:this.updateFinish()}}updateWaitToAppear(){this.timer>0?--this.timer:this.state=ae.DOTTING}updateDots(){this.timer>0?--this.timer:(++this.board.thinkingIndex>3&&(this.board.thinkingIndex=0),this.timer=ie)}updateFinish(){this.state=ae.DONE,this.thinkingDone&&(this.thinkingDone(),this.thinkingDone=null)}}var oe,ue=s(4);!function(e){e[e.WAITING_FOR_HUMAN=0]="WAITING_FOR_HUMAN",e[e.HUMAN_SOWING=1]="HUMAN_SOWING",e[e.WAITING_FOR_AI=2]="WAITING_FOR_AI",e[e.AI_SOWING=3]="AI_SOWING",e[e.CAPTURING_REMAINDER=4]="CAPTURING_REMAINDER",e[e.GAME_OVER=5]="GAME_OVER"}(oe||(oe={}));const le=new class{houseStates=new Array(14).fill(null).map(()=>new j);status=K.INTERMEDIATE;thinkingIndex=0;fadesDone=!1;constructor(){this.reset()}reset(){for(let e=13;e>=0;--e){const t=this.houseStates[e];t.seeds=e>11?0:4,t.gradient=m,t.gradientFrac=0}this.status=K.INTERMEDIATE,this.thinkingIndex=0}updateFades(){let e=!0;for(let t=13;t>=0;--t){const s=this.houseStates[t];s.gradientFrac>0&&(e=!1,s.gradientFrac=Math.max(0,s.gradientFrac-H))}const t=e&&this.fadesDone;return this.fadesDone=e,t}render(e){e.fillStyle=S.DARK_GRAY,e.fillRect(0,0,M.WIDTH,M.HEIGHT);for(let t=13;t>=0;--t){const s=this.houseStates[t];let n,i;t<6?(n=(C.SIZE+C.PADDING)*(t+1),i=C.SIZE+C.PADDING):t<12?(n=(C.SIZE+C.PADDING)*(12-t),i=0):12===t?(n=7*(C.SIZE+C.PADDING),i=(M.HEIGHT-C.SIZE)/2):(n=0,i=(M.HEIGHT-C.SIZE)/2),e.save(),e.fillStyle=s.gradient[Math.round(63*s.gradientFrac)],e.translate(n,i),e.fill(P),e.fillStyle=S.DARK_GRAY;for(let t of A[s.seeds])e.save(),e.translate(O.DIAMETER+O.DIAMETER*t.x,O.DIAMETER+O.DIAMETER*t.y),e.fill(B),e.restore();e.restore()}e.fillStyle=S.LIGHT_GRAY,e.save(),e.translate((C.SIZE-w.WIDTH)/2,((M.HEIGHT-C.SIZE)/2-w.HEIGHT)/2),e.fill(k),e.restore(),this.status===K.B_WON?(e.fillStyle=S.BROWN,e.save(),e.translate(C.SIZE/2,(M.HEIGHT-C.SIZE)/2+C.SIZE+C.PADDING+W.RADIUS),e.fill(V),e.restore()):this.status===K.A_WON?(e.fillStyle=S.BROWN,e.save(),e.translate(7*(C.SIZE+C.PADDING)+C.SIZE/2,(M.HEIGHT-C.SIZE)/2+C.SIZE+C.PADDING+W.RADIUS),e.fill(V),e.restore()):this.status===K.DRAW?(e.fillStyle=S.BROWN,e.save(),e.translate(C.SIZE/2,(M.HEIGHT-C.SIZE)/2+C.SIZE+C.PADDING+W.RADIUS),e.fill(U),e.restore(),e.save(),e.translate(7*(C.SIZE+C.PADDING)+C.SIZE/2,(M.HEIGHT-C.SIZE)/2+C.SIZE+C.PADDING+W.RADIUS),e.fill(U),e.restore()):(this.status!==K.B_FAVORED&&this.status!==K.DRAW_FAVORED||(e.fillStyle=S.BROWN,e.save(),e.translate(C.SIZE/2,(M.HEIGHT-C.SIZE)/2+C.SIZE+C.PADDING),e.fill(x),e.restore()),this.status!==K.A_FAVORED&&this.status!==K.DRAW_FAVORED||(e.fillStyle=S.BROWN,e.save(),e.translate(7*(C.SIZE+C.PADDING)+C.SIZE/2,(M.HEIGHT-C.SIZE)/2+C.SIZE+C.PADDING),e.fill(x),e.restore())),this.thinkingIndex>0&&(e.fillStyle=S.BROWN,e.save(),e.translate(C.SIZE/2,(M.HEIGHT-C.SIZE)/2+C.SIZE+2*C.PADDING+v.HEIGHT),e.fill(L[this.thinkingIndex]),e.restore())}},he=[];let ce,de=oe.WAITING_FOR_HUMAN,Ae=new n.nF,Ie=0,Ee=0,De=null,pe=null,Re=null;const fe=new Worker("scripts/worker.bundle.js");let Te,Ne;function _e(){document.getElementById("main-content").innerHTML='<canvas id="oware-canvas" class="canvas" width="1" height="1"></canvas>',Te=document.getElementById("oware-canvas"),Te&&(Te.addEventListener("click",e=>{if(!Te)return;const t=Te.getBoundingClientRect(),s=e.clientX-t.left,n=e.clientY-t.top,i=window.devicePixelRatio||1,a=Math.floor(Te.width/i),r=Math.floor(Te.height/i);a>=r?Me(M.WIDTH*s/(a-1),M.HEIGHT*n/(r-1)):Me(M.WIDTH*(1-n/(r-1)),M.HEIGHT*s/(a-1))}),ge())}function Fe(e){if(e){const t=he.findIndex(t=>t===e);t>-1&&he.splice(t,1)}}function He(){le.updateFades()&&0===he.length&&N();for(let e=0;e<he.length;++e)he[e].update()}function Se(){Ne?le.render(Ne):ge()}function ge(){if(Ne=null,Te=document.getElementById("oware-canvas"),!Te)return;Te.width=Te.height=1;const e=window.devicePixelRatio||1,t=window.innerWidth,s=window.innerHeight;let n=M.WIDTH,i=M.HEIGHT;const a=new DOMMatrix;if(t>=s){let r=1;t<M.WIDTH&&(n=t,r=n/M.WIDTH,i=r*M.HEIGHT),s<i&&(i=s,r=i/M.HEIGHT,n=r*M.WIDTH),a.a=a.d=e*r,a.b=a.c=a.e=a.f=0}else{let r=1;s<M.WIDTH&&(n=s,r=n/M.WIDTH,i=r*M.HEIGHT),t<i&&(i=t,r=i/M.HEIGHT,n=r*M.WIDTH),a.a=a.d=a.e=0,a.b=-e*r,a.c=e*r,a.f=e*n;let o=n;n=i,i=o}Te.style.width=`${Math.floor(n)}px`,Te.style.height=`${Math.floor(i)}px`,Te.width=Math.floor(e*n),Te.height=Math.floor(e*i),Ne=Te.getContext("2d"),Ne&&(Ne.setTransform(a),Te.style.left=(t-n)/2+"px",Te.style.top=(s-i)/2+"px",le.render(Ne))}function ye(){ce=new re(le),he.push(ce),ce.thinkingDoneCallback=()=>Fe(ce),T()}function Ge(){0===--Ie&&(be(),de=oe.GAME_OVER)}function me(){fe.postMessage(new ue.DQ)}function Ce(){const e=null===De?0:De.requestID+1,t=Ae.children();for(let e=t.length-1;e>=0;--e)e>0&&(t[e].parent=null);De=new ue.Nx(e,t,Ee),pe=null,Re=null,fe.postMessage(De)}function Oe(){if(de!==oe.WAITING_FOR_AI)return;if(null===De||null===pe||null===Re)return;if(De.requestID!==pe.requestID||De.requestID!==Re.requestID)return;const e=Re.results[pe.nodeIndex];if(!e)return;switch(ce&&(ce.stop(),ce=null),e.outcome){case n.Z6.DRAW:le.status=K.DRAW_FAVORED;break;case n.Z6.A_WON:le.status=K.A_FAVORED;break;case n.Z6.B_WON:le.status=K.B_FAVORED}Se();const t=new n.nF(e.bestChild);if(t.parent=Ae,Ae=t,Ae.createSownHouse>=0){de=oe.AI_SOWING;const e=new J(le,n.ai.B,Ae.createSownHouse,Ae.createCaptured,We,!1);e.updatesDoneCallback=()=>Fe(e),he.push(e),T()}else we()}function we(){de=oe.CAPTURING_REMAINDER,Ie=2;const e=new se(le,n.ai.A,Ge);he.push(e),e.updatesDoneCallback=()=>Fe(e);const t=new se(le,n.ai.B,Ge);he.push(t),t.updatesDoneCallback=()=>Fe(t),T()}function We(){if(Ae.type!==n.Z6.INTERMEDIATE)Ae.createOperation===n._j.CAPTURED_REMAINDER?we():(be(),de=oe.GAME_OVER);else{const e=Ae.children();1===e.length&&e[0].createOperation===n._j.CAPTURED_REMAINDER&&e[0].createSownHouse<0?(Ae=e[0],we()):(de=oe.WAITING_FOR_HUMAN,Ce())}}function be(){switch(Ae.type){case n.Z6.DRAW:le.status=K.DRAW;break;case n.Z6.A_WON:le.status=K.A_WON;break;case n.Z6.B_WON:le.status=K.B_WON}Se()}async function ve(){be(),Ae.type===n.Z6.INTERMEDIATE?(de=oe.WAITING_FOR_AI,ye(),Oe()):Ae.createOperation===n._j.CAPTURED_REMAINDER?we():(be(),de=oe.GAME_OVER)}function Me(e,t){if(e<C.SIZE+C.PADDING/2)t<(C.SIZE+C.PADDING)/2&&Ze(de===oe.GAME_OVER);else if(t>=C.SIZE+C.PADDING/2){const t=Math.floor((e-(C.SIZE+C.PADDING/2))/(C.SIZE+C.PADDING));if(t<0||t>5)return;!function(e){if(de!==oe.WAITING_FOR_HUMAN||null===De)return;const t=De.nodes;let s=0;e:{for(let n=t.length-1;n>=0;--n)if(t[n].createSownHouse===e){s=n;break e}return}de=oe.HUMAN_SOWING,Ae=t[s],Ae.type===n.Z6.INTERMEDIATE?function(e){null!==De&&(pe=new ue.pR(De.requestID,e),null===Re?fe.postMessage(pe):Oe())}(s):me();const i=new J(le,n.ai.A,e,Ae.createCaptured,ve,!0);i.updatesDoneCallback=()=>Fe(i),he.push(i),T()}(t)}}function Pe(){const e=document.getElementById("quit-buttons"),t=document.getElementById("quit-button"),s=document.getElementById("resume-button");e.style.top=e.style.left=e.style.transform=s.style.width=t.style.width="",e.style.display="none";const n=window.innerWidth,i=window.innerHeight;if(e.style.display="block",t.style.width=s.style.width=`${s.getBoundingClientRect().width}px`,n>=i){const t=e.getBoundingClientRect();e.style.left=(n-t.width)/2+"px",e.style.top=(i-t.height)/2+"px"}else{e.style.transform="rotate(-90deg)";const t=e.getBoundingClientRect();e.style.left=(n-t.height)/2+"px",e.style.top=(i-t.width)/2+"px"}}var Be;fe.onmessage=e=>{const t=e.data;var s;t.type===ue.Go.SEARCH_RESPONSE&&(s=t,null!==De&&De.requestID===s.requestID&&(Re=s,Oe()))},function(e){e[e.START=0]="START",e[e.GAME=1]="GAME",e[e.QUIT=2]="QUIT"}(Be||(Be={}));let ke=Be.START,Ve=null,Ue=!1,Le=null;function xe(e,t){ke=Be.GAME,Ye(),_e(),function(e,t){Ae=new n.nF,le.reset(),he.length=0,ce=null,Ie=0,Ee=t,De=null,pe=null,Re=null,Se(),me(),N(),e===n.ai.A?(Ae.createPlayer=n.ai.B,de=oe.WAITING_FOR_HUMAN,Ce()):(Ae.createPlayer=n.ai.A,de=oe.WAITING_FOR_AI,De=new ue.Nx(0,[Ae],Ee),pe=new ue.pR(0,0),Re=null,fe.postMessage(De),ye())}(e,t)}function Ze(e){e?qe():(ke=Be.QUIT,document.getElementById("main-content").innerHTML='\n            <div id="quit-buttons">\n                <button id="quit-button">Quit</button>\n                <button id="resume-button">Resume</button>\n            </div>',document.getElementById("quit-button").addEventListener("click",e=>qe()),document.getElementById("resume-button").addEventListener("click",e=>$e()),Pe())}function qe(){ke=Be.START,null!==Ve&&"wakeLock"in navigator&&(Ue=!1,Ve.release().then(()=>{Ue||(Ve=null)}).catch(e=>{})),me(),N(),l()}function $e(){ke=Be.GAME,_e()}function Qe(){switch(ke){case Be.START:c();break;case Be.GAME:ge();break;case Be.QUIT:Pe()}}function Ye(){!Ue&&null===Ve&&"wakeLock"in navigator&&(Ue=!0,navigator.wakeLock.request("screen").then(e=>{Ue&&(Ve=e,Ve.addEventListener("release",()=>{Ue||(Ve=null)}))}).catch(e=>{}).finally(()=>Ue=!1))}const je=()=>{null!=Le&&Le();const e=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);e.addEventListener("change",je),Le=()=>e.removeEventListener("change",je),Qe()};document.addEventListener("DOMContentLoaded",function(){document.addEventListener("dblclick",e=>e.preventDefault(),{passive:!1}),window.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1}),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&ke!==Be.START&&Ye()}),window.addEventListener("resize",Qe),l(),je()})})();